<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MediCarbon – Emission Tracking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --accent: #22c55e;
      --accent-red: #ef4444;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-subtle: #e5e7eb;
      --sidebar-bg: #ffffff;
      --sidebar-border: #e5e7eb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app-shell {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background: var(--sidebar-bg);
      border-right: 1px solid var(--sidebar-border);
      padding: 16px 14px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      padding-bottom: 16px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .brand-logo {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #10b981;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
    }

    .brand-name {
      font-weight: 700;
      font-size: 16px;
    }

    .nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .nav-item { margin-bottom: 4px; }

    .nav-link {
      display: block;
      padding: 8px 10px;
      border-radius: 8px;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 14px;
    }

    .nav-link.active {
      background: #ecfdf5;
      color: #059669;
      font-weight: 600;
    }

    /* Main */
    .main {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .page-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .page-title {
      font-size: 22px;
      font-weight: 700;
    }

    .page-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 16px;
    }

    .col-3 { grid-column: span 3; }
    .col-6 { grid-column: span 6; }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 16px 18px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .kpi-value {
      font-size: 24px;
      font-weight: 700;
    }

    .kpi-unit {
      font-size: 14px;
      color: var(--text-muted);
      margin-left: 4px;
    }

    .kpi-trend {
      font-size: 12px;
      margin-top: 4px;
    }

    .trend-up { color: var(--accent-red); }
    .trend-down { color: var(--accent); }

    /* Charts */
    .chart-box {
      width: 100%;
      height: 260px;
      padding: 10px;
    }

    .chart-box canvas {
      width: 100% !important;
      height: 100% !important;
    }

    @media (max-width: 1024px) {
      .sidebar { display: none; }
      .main { padding: 12px; }
      .col-3, .col-6 { grid-column: span 12; }
    }
  </style>
</head>

<body data-active-page="emissions">
<div class="app-shell">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-logo">M</div>
      <div class="brand-name">MediCarbon</div>
    </div>
    <ul class="nav-list" id="nav-list"></ul>
  </aside>

  <!-- Main -->
  <main class="main">
    <header class="page-header">
      <div class="page-title">Emission Tracking</div>
      <div class="page-subtitle">Monitor and analyze emission levels across all categories</div>
    </header>

    <!-- KPI cards (same data as overview) -->
    <section class="grid">
      <div class="card col-3">
        <div class="card-subtitle">Total CO₂</div>
        <div class="kpi-value">
          <span id="total-co2-value"></span><span class="kpi-unit" id="total-co2-unit"></span>
        </div>
        <div class="kpi-trend" id="total-co2-trend"></div>
      </div>

      <div class="card col-3">
        <div class="card-subtitle">NO₂ Emissions</div>
        <div class="kpi-value">
          <span id="no2-value"></span><span class="kpi-unit" id="no2-unit"></span>
        </div>
        <div class="kpi-trend" id="no2-trend"></div>
      </div>

      <div class="card col-3">
        <div class="card-subtitle">Methane (CH₄)</div>
        <div class="kpi-value">
          <span id="ch4-value"></span><span class="kpi-unit" id="ch4-unit"></span>
        </div>
        <div class="kpi-trend" id="ch4-trend"></div>
      </div>

      <div class="card col-3">
        <div class="card-subtitle">N₂O</div>
        <div class="kpi-value">
          <span id="n2o-value"></span><span class="kpi-unit" id="n2o-unit"></span>
        </div>
        <div class="kpi-trend" id="n2o-trend"></div>
      </div>
    </section>

    <!-- Line chart -->
    <section class="card">
      <div class="card-title">Emissions Trend (6 Months)</div>
      <div class="chart-box">
        <canvas id="trendChart"></canvas>
      </div>
    </section>

    <!-- Bar chart -->
    <section class="card">
      <div class="card-title">Emissions by Source</div>
      <div class="chart-box">
        <canvas id="sourceChart"></canvas>
      </div>
    </section>
  </main>
</div>

<script>
  function buildNav(navItems) {
    const list = document.getElementById("nav-list");
    const activePage = document.body.getAttribute("data-active-page");
    navItems.forEach(item => {
      const li = document.createElement("li");
      li.className = "nav-item";
      const a = document.createElement("a");
      a.className = "nav-link" + (item.id === activePage ? " active" : "");
      a.href = item.href || "#";
      a.textContent = item.label;
      li.appendChild(a);
      list.appendChild(li);
    });
  }

  function renderTrend(el, trend) {
    if (!trend) return;
    const arrow = document.createElement("span");
    arrow.textContent = trend.direction === "down" ? "▼ " : "▲ ";
    el.textContent = "";
    el.appendChild(arrow);
    el.appendChild(document.createTextNode(trend.text));
    el.classList.add(trend.direction === "down" ? "trend-down" : "trend-up");
  }

  function createLineChart(ctx, labels, series) {
    const datasets = series.map(s => ({
      label: s.label,
      data: s.values,
      borderColor: s.color,
      backgroundColor: s.color,
      tension: 0.3,
      pointRadius: 3,
      pointHoverRadius: 4,
      fill: false
    }));

    return new Chart(ctx, {
      type: "line",
      data: { labels, datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: "bottom", labels: { boxWidth: 12, font: { size: 11 } } },
          tooltip: { mode: "index", intersect: false }
        },
        interaction: { mode: "index", intersect: false },
        scales: {
          y: {
            beginAtZero: false,
            grid: { color: "#e5e7eb" }
          },
          x: {
            grid: { display: false }
          }
        }
      }
    });
  }

  function createBarChart(ctx, labels, values, color) {
    return new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: "CO₂ Emissions (kg)",
          data: values,
          backgroundColor: color
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: "bottom", labels: { boxWidth: 12, font: { size: 11 } } }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: { color: "#e5e7eb" }
          },
          x: {
            grid: { display: false }
          }
        }
      }
    });
  }

  fetch("../vendor.json")
    .then(r => r.json())
    .then(data => {
      // Sidebar nav
      buildNav(data.navigation);

      // KPI cards (reuse overview data)
      const ov = data.overview;
      document.getElementById("total-co2-value").textContent = ov.total_co2.value;
      document.getElementById("total-co2-unit").textContent = ov.total_co2.unit;
      renderTrend(document.getElementById("total-co2-trend"), ov.total_co2.trend);

      document.getElementById("no2-value").textContent = ov.no2.value;
      document.getElementById("no2-unit").textContent = ov.no2.unit;
      renderTrend(document.getElementById("no2-trend"), ov.no2.trend);

      document.getElementById("ch4-value").textContent = ov.ch4.value;
      document.getElementById("ch4-unit").textContent = ov.ch4.unit;
      renderTrend(document.getElementById("ch4-trend"), ov.ch4.trend);

      document.getElementById("n2o-value").textContent = ov.n2o.value;
      document.getElementById("n2o-unit").textContent = ov.n2o.unit;
      renderTrend(document.getElementById("n2o-trend"), ov.n2o.trend);

      // Line chart data
      const trend = data.emissions_trend;
      createLineChart(
        document.getElementById("trendChart"),
        trend.months,
        trend.series
      );

      // Bar chart data
      const src = data.emissions_by_source;
      createBarChart(
        document.getElementById("sourceChart"),
        src.labels,
        src.values,
        src.color
      );
    })
    .catch(err => console.error("Error loading vendor.json:", err));
</script>
</body>
</html>
